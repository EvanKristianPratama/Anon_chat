{
  "version": 3,
  "sources": ["../../../src/config.ts", "../../../src/http-gateway.ts", "../../../src/chat-state.ts", "../../../src/utils.ts", "../../../src/payload-parsers.ts", "../../../src/protocol.ts", "../../../src/rate-limiter.ts", "../../../src/services/admin-service.ts", "../../../src/services/queue-service.ts", "../../../src/services/room-service.ts", "../../../src/types.ts", "../../../src/chat-durable-object.ts", "../../../src/index.ts", "../../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-PuNaRI/middleware-insertion-facade.js", "../../../../../../../.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts", "../bundle-PuNaRI/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/mac/Desktop/anon_cb/apps/worker/.wrangler/tmp/dev-kw7Qjc",
  "sourcesContent": ["import type { Env } from \"./types\";\n\nexport interface ChatConfig {\n  adminToken: string;\n  maxMessageLength: number;\n  maxImageBytes: number;\n  idleTimeoutMs: number;\n  maxSessionMs: number;\n}\n\nconst parseNumber = (value: string | undefined, fallback: number): number => {\n  if (!value) {\n    return fallback;\n  }\n\n  const parsed = Number(value);\n  return Number.isFinite(parsed) ? parsed : fallback;\n};\n\nexport const createChatConfig = (env: Env): ChatConfig => {\n  return {\n    adminToken: env.ADMIN_TOKEN ?? \"dev-admin-token\",\n    maxMessageLength: parseNumber(env.MAX_MESSAGE_LENGTH, 500),\n    maxImageBytes: parseNumber(env.MAX_IMAGE_BYTES, 1_000_000),\n    idleTimeoutMs: parseNumber(env.IDLE_TIMEOUT_SEC, 60) * 1000,\n    maxSessionMs: parseNumber(env.MAX_SESSION_SEC, 900) * 1000\n  };\n};\n\nexport const resolveCorsOrigin = (env: Env): string => env.CORS_ORIGIN ?? \"*\";\n", "import { resolveCorsOrigin } from \"./config\";\nimport type { Env } from \"./types\";\n\nconst USER_SOCKET_PATH = \"/ws\";\nconst ADMIN_SOCKET_PATH = \"/admin/ws\";\n\nconst withCorsHeaders = (corsOrigin: string): HeadersInit => ({\n  \"Access-Control-Allow-Origin\": corsOrigin\n});\n\nconst createPreflightResponse = (corsOrigin: string): Response =>\n  new Response(null, {\n    status: 204,\n    headers: {\n      \"Access-Control-Allow-Origin\": corsOrigin,\n      \"Access-Control-Allow-Methods\": \"GET,OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type,Authorization\"\n    }\n  });\n\nconst createHealthResponse = (corsOrigin: string): Response =>\n  Response.json(\n    {\n      ok: true,\n      at: Date.now()\n    },\n    {\n      headers: withCorsHeaders(corsOrigin)\n    }\n  );\n\nconst isChatSocketPath = (pathname: string): boolean => {\n  return pathname === USER_SOCKET_PATH || pathname === ADMIN_SOCKET_PATH;\n};\n\nexport const handleEdgeRequest = async (request: Request, env: Env): Promise<Response> => {\n  const url = new URL(request.url);\n  const corsOrigin = resolveCorsOrigin(env);\n\n  if (request.method === \"OPTIONS\") {\n    return createPreflightResponse(corsOrigin);\n  }\n\n  if (url.pathname === \"/\" || url.pathname === \"/health\") {\n    return createHealthResponse(corsOrigin);\n  }\n\n  if (!isChatSocketPath(url.pathname)) {\n    return new Response(\"Not Found\", { status: 404 });\n  }\n\n  if (request.headers.get(\"Upgrade\")?.toLowerCase() !== \"websocket\") {\n    return new Response(\"Expected websocket upgrade\", { status: 426 });\n  }\n\n  const role = url.pathname === ADMIN_SOCKET_PATH ? \"admin\" : \"user\";\n  const doId = env.CHAT_DO.idFromName(\"global-chat\");\n  const stub = env.CHAT_DO.get(doId);\n\n  const proxiedHeaders = new Headers(request.headers);\n  proxiedHeaders.set(\"x-role\", role);\n  proxiedHeaders.set(\"x-client-ip\", request.headers.get(\"CF-Connecting-IP\") ?? \"0.0.0.0\");\n\n  const proxiedRequest = new Request(\"https://do.internal/connect\", {\n    method: \"GET\",\n    headers: proxiedHeaders\n  });\n\n  return stub.fetch(proxiedRequest);\n};\n", "import type { AdminMetrics, AdminSession, RoomRecord, UserSession } from \"./types\";\n\nexport class ChatState {\n  readonly users = new Map<string, UserSession>();\n  readonly admins = new Map<string, AdminSession>();\n  readonly rooms = new Map<string, RoomRecord>();\n  readonly waitingQueue: string[] = [];\n  readonly waitingMembers = new Set<string>();\n\n  private sessionDurationSumSec = 0;\n  private sessionCount = 0;\n  private peakOnlineUsers = 0;\n\n  markUserConnected(): void {\n    if (this.users.size > this.peakOnlineUsers) {\n      this.peakOnlineUsers = this.users.size;\n    }\n  }\n\n  recordSessionDurationSec(durationSec: number): void {\n    this.sessionDurationSumSec += Math.max(0, durationSec);\n    this.sessionCount += 1;\n  }\n\n  snapshotAdminMetrics(): AdminMetrics {\n    return {\n      onlineUsers: this.users.size,\n      activeRooms: this.rooms.size,\n      avgSessionDurationSec: this.sessionCount > 0 ? this.sessionDurationSumSec / this.sessionCount : 0,\n      peakOnlineUsers: this.peakOnlineUsers,\n      at: Date.now()\n    };\n  }\n}\n", "export const sanitizeText = (value: string): string =>\n  value\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/javascript:/gi, \"\")\n    .replace(/on\\w+\\s*=/gi, \"\");\n\nexport const normalizeAlias = (value: string): string | null => {\n  const normalized = sanitizeText(value.trim().replace(/\\s+/g, \" \").slice(0, 24));\n  return normalized.length >= 2 ? normalized : null;\n};\n\nexport const base64ByteLength = (raw: string): number => {\n  const base64 = raw.includes(\",\") ? raw.split(\",\").pop() ?? \"\" : raw;\n  const padding = base64.endsWith(\"==\") ? 2 : base64.endsWith(\"=\") ? 1 : 0;\n  return Math.floor((base64.length * 3) / 4) - padding;\n};\n\nexport const isObjectRecord = (value: unknown): value is Record<string, unknown> => {\n  return typeof value === \"object\" && value !== null;\n};\n", "import { isObjectRecord } from \"./utils\";\nimport type {\n  AdminSubscribePayload,\n  ChatImagePayload,\n  ChatTextPayload,\n  QueueJoinPayload\n} from \"./types\";\n\nexport const parseQueueJoinPayload = (rawPayload: unknown): QueueJoinPayload | null => {\n  if (!isObjectRecord(rawPayload)) {\n    return null;\n  }\n\n  if (\"alias\" in rawPayload && typeof rawPayload.alias !== \"string\") {\n    return null;\n  }\n\n  return rawPayload as QueueJoinPayload;\n};\n\nexport const parseChatTextPayload = (rawPayload: unknown): ChatTextPayload | null => {\n  if (!isObjectRecord(rawPayload)) {\n    return null;\n  }\n\n  if (typeof rawPayload.text !== \"string\") {\n    return null;\n  }\n\n  return rawPayload as ChatTextPayload;\n};\n\nexport const parseChatImagePayload = (rawPayload: unknown): ChatImagePayload | null => {\n  if (!isObjectRecord(rawPayload)) {\n    return null;\n  }\n\n  const mime = rawPayload.mime;\n  const data = rawPayload.data;\n\n  if (mime !== undefined && typeof mime !== \"string\") {\n    return null;\n  }\n\n  if (data !== undefined && typeof data !== \"string\") {\n    return null;\n  }\n\n  return rawPayload as ChatImagePayload;\n};\n\nexport const parseAdminSubscribePayload = (rawPayload: unknown): AdminSubscribePayload | null => {\n  if (!isObjectRecord(rawPayload)) {\n    return null;\n  }\n\n  if (typeof rawPayload.token !== \"string\") {\n    return null;\n  }\n\n  return rawPayload as AdminSubscribePayload;\n};\n", "import type { ErrorCode, WsEnvelope } from \"./types\";\n\nexport const parseEnvelope = (raw: unknown): WsEnvelope | null => {\n  if (typeof raw !== \"string\") {\n    return null;\n  }\n\n  try {\n    const parsed = JSON.parse(raw) as WsEnvelope;\n    if (!parsed || typeof parsed.event !== \"string\") {\n      return null;\n    }\n    return parsed;\n  } catch {\n    return null;\n  }\n};\n\nexport const safeClose = (socket: WebSocket): void => {\n  try {\n    socket.close();\n  } catch {\n    // no-op\n  }\n};\n\nexport const emit = (socket: WebSocket, event: string, payload?: unknown): void => {\n  try {\n    socket.send(JSON.stringify({ event, payload } satisfies WsEnvelope));\n  } catch {\n    safeClose(socket);\n  }\n};\n\nexport const emitSystemError = (socket: WebSocket, code: ErrorCode, message: string): void => {\n  emit(socket, \"system:error\", { code, message });\n};\n", "interface RateBucket {\n  count: number;\n  expiresAt: number;\n}\n\nexport class InMemoryRateLimiter {\n  private readonly buckets = new Map<string, RateBucket>();\n\n  allow(ip: string, action: string, limit: number, windowSec: number): boolean {\n    const now = Date.now();\n    const bucket = Math.floor(now / (windowSec * 1000));\n    const key = `${ip}:${action}:${bucket}`;\n\n    const current = this.buckets.get(key);\n    if (!current) {\n      this.buckets.set(key, {\n        count: 1,\n        expiresAt: now + windowSec * 1000 + 1000\n      });\n      this.gc(now);\n      return true;\n    }\n\n    current.count += 1;\n    this.gc(now);\n    return current.count <= limit;\n  }\n\n  private gc(now: number): void {\n    for (const [key, bucket] of this.buckets.entries()) {\n      if (bucket.expiresAt <= now) {\n        this.buckets.delete(key);\n      }\n    }\n  }\n}\n", "import type { ChatConfig } from \"../config\";\nimport { emit, emitSystemError, parseEnvelope, safeClose } from \"../protocol\";\nimport { parseAdminSubscribePayload } from \"../payload-parsers\";\nimport type { ChatState } from \"../chat-state\";\n\nexport class AdminService {\n  constructor(\n    private readonly state: ChatState,\n    private readonly config: ChatConfig\n  ) {}\n\n  connect(socket: WebSocket): string {\n    const adminId = crypto.randomUUID();\n    this.state.admins.set(adminId, {\n      adminId,\n      socket,\n      authorized: false\n    });\n\n    return adminId;\n  }\n\n  disconnect(adminId: string): void {\n    this.state.admins.delete(adminId);\n  }\n\n  handleMessage(adminId: string, raw: unknown): void {\n    const admin = this.state.admins.get(adminId);\n    if (!admin) {\n      return;\n    }\n\n    const envelope = parseEnvelope(raw);\n    if (!envelope) {\n      emitSystemError(admin.socket, \"BAD_REQUEST\", \"Invalid payload.\");\n      return;\n    }\n\n    if (envelope.event !== \"admin:subscribe\") {\n      emitSystemError(admin.socket, \"BAD_REQUEST\", \"Unsupported admin event.\");\n      return;\n    }\n\n    const payload = parseAdminSubscribePayload(envelope.payload);\n    if (!payload || payload.token !== this.config.adminToken) {\n      emitSystemError(admin.socket, \"BAD_REQUEST\", \"Invalid admin token.\");\n      safeClose(admin.socket);\n      this.disconnect(adminId);\n      return;\n    }\n\n    admin.authorized = true;\n    emit(admin.socket, \"admin:metrics\", this.state.snapshotAdminMetrics());\n  }\n\n  broadcastMetrics(): void {\n    const payload = this.state.snapshotAdminMetrics();\n    for (const admin of this.state.admins.values()) {\n      if (!admin.authorized) {\n        continue;\n      }\n\n      emit(admin.socket, \"admin:metrics\", payload);\n    }\n  }\n}\n", "import type { ChatState } from \"../chat-state\";\nimport type { RoomRecord, UserSession } from \"../types\";\nimport { RoomService } from \"./room-service\";\n\nexport interface MatchResult {\n  room: RoomRecord;\n  first: UserSession;\n  second: UserSession;\n}\n\nexport class QueueService {\n  constructor(\n    private readonly state: ChatState,\n    private readonly roomService: RoomService\n  ) {}\n\n  enqueue(userId: string): boolean {\n    if (this.state.waitingMembers.has(userId)) {\n      return false;\n    }\n\n    this.state.waitingMembers.add(userId);\n    this.state.waitingQueue.push(userId);\n    return true;\n  }\n\n  remove(userId: string): void {\n    this.state.waitingMembers.delete(userId);\n    this.removeFromQueue(userId);\n  }\n\n  createMatches(): MatchResult[] {\n    const matches: MatchResult[] = [];\n\n    while (this.state.waitingQueue.length >= 2) {\n      const firstId = this.dequeueNextEligible();\n      if (!firstId) {\n        return matches;\n      }\n\n      const secondId = this.dequeueNextEligible();\n      if (!secondId) {\n        this.state.waitingMembers.add(firstId);\n        this.state.waitingQueue.unshift(firstId);\n        return matches;\n      }\n\n      const room = this.roomService.createRoom(firstId, secondId);\n      if (!room) {\n        continue;\n      }\n\n      const first = this.state.users.get(firstId);\n      const second = this.state.users.get(secondId);\n      if (!first || !second) {\n        continue;\n      }\n\n      matches.push({ room, first, second });\n    }\n\n    return matches;\n  }\n\n  private dequeueNextEligible(): string | null {\n    while (this.state.waitingQueue.length > 0) {\n      const userId = this.state.waitingQueue.shift();\n      if (!userId) {\n        return null;\n      }\n\n      if (!this.state.waitingMembers.delete(userId)) {\n        continue;\n      }\n\n      const user = this.state.users.get(userId);\n      if (!user || user.roomId) {\n        continue;\n      }\n\n      return userId;\n    }\n\n    return null;\n  }\n\n  private removeFromQueue(userId: string): void {\n    for (let index = this.state.waitingQueue.length - 1; index >= 0; index -= 1) {\n      if (this.state.waitingQueue[index] === userId) {\n        this.state.waitingQueue.splice(index, 1);\n      }\n    }\n  }\n}\n", "import type { ChatState } from \"../chat-state\";\nimport type { ChatConfig } from \"../config\";\nimport { emit, emitSystemError } from \"../protocol\";\nimport type { EndReason, ImageMime, RoomRecord, UserSession } from \"../types\";\n\ninterface RelayContext {\n  room: RoomRecord;\n  fromUser: UserSession;\n  partner: UserSession;\n}\n\nexport class RoomService {\n  constructor(\n    private readonly state: ChatState,\n    private readonly config: ChatConfig\n  ) {}\n\n  createRoom(firstUserId: string, secondUserId: string): RoomRecord | null {\n    const first = this.state.users.get(firstUserId);\n    const second = this.state.users.get(secondUserId);\n    if (!first || !second || first.roomId || second.roomId) {\n      return null;\n    }\n\n    const roomId = crypto.randomUUID();\n    const now = Date.now();\n    const room: RoomRecord = {\n      roomId,\n      userA: first.userId,\n      userB: second.userId,\n      startedAt: now,\n      lastActivityAt: now\n    };\n\n    this.state.rooms.set(room.roomId, room);\n    first.roomId = room.roomId;\n    second.roomId = room.roomId;\n\n    return room;\n  }\n\n  findByUser(userId: string): RoomRecord | null {\n    const roomId = this.state.users.get(userId)?.roomId;\n    if (!roomId) {\n      return null;\n    }\n\n    return this.state.rooms.get(roomId) ?? null;\n  }\n\n  touchByUser(userId: string): void {\n    const room = this.findByUser(userId);\n    if (room) {\n      room.lastActivityAt = Date.now();\n    }\n  }\n\n  relayText(fromUserId: string, text: string): void {\n    const relay = this.resolveRelayContext(fromUserId);\n    if (!relay) {\n      return;\n    }\n\n    relay.room.lastActivityAt = Date.now();\n    emit(relay.partner.socket, \"chat:text\", {\n      from: relay.fromUser.userId,\n      alias: relay.fromUser.alias,\n      text,\n      at: Date.now()\n    });\n  }\n\n  relayImage(fromUserId: string, mime: ImageMime, data: string): void {\n    const relay = this.resolveRelayContext(fromUserId);\n    if (!relay) {\n      return;\n    }\n\n    relay.room.lastActivityAt = Date.now();\n    emit(relay.partner.socket, \"chat:image\", {\n      from: relay.fromUser.userId,\n      alias: relay.fromUser.alias,\n      mime,\n      data,\n      at: Date.now()\n    });\n  }\n\n  endByUser(userId: string, reason: EndReason): boolean {\n    const room = this.findByUser(userId);\n    if (!room) {\n      return false;\n    }\n\n    return this.endById(room.roomId, reason, userId);\n  }\n\n  endById(roomId: string, reason: EndReason, actorUserId?: string): boolean {\n    const room = this.state.rooms.get(roomId);\n    if (!room) {\n      return false;\n    }\n\n    this.state.rooms.delete(roomId);\n\n    const userA = this.state.users.get(room.userA);\n    const userB = this.state.users.get(room.userB);\n    if (userA) {\n      userA.roomId = undefined;\n    }\n    if (userB) {\n      userB.roomId = undefined;\n    }\n\n    const durationSec = Math.max(0, (Date.now() - room.startedAt) / 1000);\n    this.state.recordSessionDurationSec(durationSec);\n\n    if (reason === \"skip\" && actorUserId) {\n      const partnerId = this.resolvePartnerId(room, actorUserId);\n      const partner = this.state.users.get(partnerId);\n      if (partner) {\n        emit(partner.socket, \"room:ended\", { reason });\n      }\n      return true;\n    }\n\n    if (userA) {\n      emit(userA.socket, \"room:ended\", { reason });\n    }\n    if (userB) {\n      emit(userB.socket, \"room:ended\", { reason });\n    }\n\n    return true;\n  }\n\n  sweepExpired(): number {\n    const now = Date.now();\n    let ended = 0;\n\n    for (const room of Array.from(this.state.rooms.values())) {\n      const idleMs = now - room.lastActivityAt;\n      const durationMs = now - room.startedAt;\n\n      if (idleMs > this.config.idleTimeoutMs) {\n        if (this.endById(room.roomId, \"timeout\")) {\n          ended += 1;\n        }\n        continue;\n      }\n\n      if (durationMs > this.config.maxSessionMs) {\n        if (this.endById(room.roomId, \"max_duration\")) {\n          ended += 1;\n        }\n      }\n    }\n\n    return ended;\n  }\n\n  private resolveRelayContext(fromUserId: string): RelayContext | null {\n    const fromUser = this.state.users.get(fromUserId);\n    const room = this.findByUser(fromUserId);\n    if (!fromUser || !room) {\n      if (fromUser) {\n        emitSystemError(fromUser.socket, \"NOT_IN_ROOM\", \"You are not in an active room.\");\n      }\n      return null;\n    }\n\n    const partnerId = this.resolvePartnerId(room, fromUserId);\n    const partner = this.state.users.get(partnerId);\n    if (!partner) {\n      return null;\n    }\n\n    return { room, fromUser, partner };\n  }\n\n  private resolvePartnerId(room: RoomRecord, userId: string): string {\n    return room.userA === userId ? room.userB : room.userA;\n  }\n}\n", "export interface DurableObjectNamespaceLike {\n  idFromName(name: string): unknown;\n  get(id: unknown): { fetch(request: Request): Promise<Response> };\n}\n\nexport interface Env {\n  CHAT_DO: DurableObjectNamespaceLike;\n  ADMIN_TOKEN?: string;\n  CORS_ORIGIN?: string;\n  MAX_MESSAGE_LENGTH?: string;\n  MAX_IMAGE_BYTES?: string;\n  IDLE_TIMEOUT_SEC?: string;\n  MAX_SESSION_SEC?: string;\n}\n\nexport interface WsEnvelope<TPayload = unknown> {\n  event: string;\n  payload?: TPayload;\n}\n\nexport type ImageMime = \"image/jpeg\" | \"image/png\" | \"image/webp\";\n\nexport const ALLOWED_IMAGE_MIME = new Set<ImageMime>([\"image/jpeg\", \"image/png\", \"image/webp\"]);\n\nexport type EndReason = \"skip\" | \"disconnect\" | \"timeout\" | \"max_duration\";\n\nexport type ErrorCode =\n  | \"RATE_LIMITED\"\n  | \"BAD_REQUEST\"\n  | \"MESSAGE_TOO_LONG\"\n  | \"IMAGE_TOO_LARGE\"\n  | \"UNSUPPORTED_IMAGE\"\n  | \"NOT_IN_ROOM\";\n\nexport interface UserSession {\n  userId: string;\n  socket: WebSocket;\n  ip: string;\n  alias?: string;\n  roomId?: string;\n}\n\nexport interface AdminSession {\n  adminId: string;\n  socket: WebSocket;\n  authorized: boolean;\n}\n\nexport interface RoomRecord {\n  roomId: string;\n  userA: string;\n  userB: string;\n  startedAt: number;\n  lastActivityAt: number;\n}\n\nexport interface AdminMetrics {\n  onlineUsers: number;\n  activeRooms: number;\n  avgSessionDurationSec: number;\n  peakOnlineUsers: number;\n  at: number;\n}\n\nexport interface QueueJoinPayload {\n  alias?: string;\n}\n\nexport interface ChatTextPayload {\n  text?: string;\n}\n\nexport interface ChatImagePayload {\n  mime?: ImageMime;\n  data?: string;\n}\n\nexport interface AdminSubscribePayload {\n  token?: string;\n}\n", "import { ChatState } from \"./chat-state\";\nimport { createChatConfig } from \"./config\";\nimport { parseChatImagePayload, parseChatTextPayload, parseQueueJoinPayload } from \"./payload-parsers\";\nimport { emit, emitSystemError, parseEnvelope, safeClose } from \"./protocol\";\nimport { InMemoryRateLimiter } from \"./rate-limiter\";\nimport { AdminService } from \"./services/admin-service\";\nimport { QueueService } from \"./services/queue-service\";\nimport { RoomService } from \"./services/room-service\";\nimport { base64ByteLength, normalizeAlias, sanitizeText } from \"./utils\";\nimport { ALLOWED_IMAGE_MIME, type Env, type UserSession } from \"./types\";\n\nexport class ChatDurableObject {\n  private readonly chatState = new ChatState();\n  private readonly config;\n  private readonly rateLimiter = new InMemoryRateLimiter();\n\n  private readonly adminService: AdminService;\n  private readonly roomService: RoomService;\n  private readonly queueService: QueueService;\n\n  constructor(\n    private readonly state: unknown,\n    private readonly env: Env\n  ) {\n    this.config = createChatConfig(env);\n    this.roomService = new RoomService(this.chatState, this.config);\n    this.queueService = new QueueService(this.chatState, this.roomService);\n    this.adminService = new AdminService(this.chatState, this.config);\n\n    setInterval(() => {\n      this.roomService.sweepExpired();\n      this.adminService.broadcastMetrics();\n    }, 2_000);\n  }\n\n  async fetch(request: Request): Promise<Response> {\n    if (request.headers.get(\"Upgrade\")?.toLowerCase() !== \"websocket\") {\n      return new Response(\"Expected websocket upgrade\", { status: 426 });\n    }\n\n    const role = request.headers.get(\"x-role\") === \"admin\" ? \"admin\" : \"user\";\n    const ip = request.headers.get(\"x-client-ip\") ?? \"0.0.0.0\";\n\n    const pair = new WebSocketPair();\n    const client = pair[0];\n    const server = pair[1];\n    server.accept();\n\n    if (role === \"admin\") {\n      this.acceptAdmin(server);\n    } else {\n      this.acceptUser(server, ip);\n    }\n\n    return new Response(null, {\n      status: 101,\n      webSocket: client\n    } as ResponseInit & { webSocket: WebSocket });\n  }\n\n  private acceptAdmin(socket: WebSocket): void {\n    const adminId = this.adminService.connect(socket);\n\n    socket.addEventListener(\"message\", (event) => {\n      this.adminService.handleMessage(adminId, event.data);\n    });\n\n    socket.addEventListener(\"close\", () => {\n      this.adminService.disconnect(adminId);\n    });\n\n    socket.addEventListener(\"error\", () => {\n      this.adminService.disconnect(adminId);\n      safeClose(socket);\n    });\n  }\n\n  private acceptUser(socket: WebSocket, ip: string): void {\n    const userId = crypto.randomUUID();\n    this.chatState.users.set(userId, {\n      userId,\n      socket,\n      ip\n    });\n    this.chatState.markUserConnected();\n    this.adminService.broadcastMetrics();\n\n    socket.addEventListener(\"message\", (event) => {\n      this.onUserMessage(userId, event.data);\n    });\n\n    socket.addEventListener(\"close\", () => {\n      this.disconnectUser(userId);\n    });\n\n    socket.addEventListener(\"error\", () => {\n      this.disconnectUser(userId);\n      safeClose(socket);\n    });\n  }\n\n  private onUserMessage(userId: string, raw: unknown): void {\n    const user = this.chatState.users.get(userId);\n    if (!user) {\n      return;\n    }\n\n    const envelope = parseEnvelope(raw);\n    if (!envelope) {\n      emitSystemError(user.socket, \"BAD_REQUEST\", \"Invalid payload.\");\n      return;\n    }\n\n    switch (envelope.event) {\n      case \"queue:join\":\n        this.handleQueueJoin(user, envelope.payload);\n        return;\n      case \"room:skip\":\n        this.handleRoomSkip(user);\n        return;\n      case \"room:stay\":\n        this.handleRoomStay(user);\n        return;\n      case \"session:heartbeat\":\n        this.roomService.touchByUser(user.userId);\n        return;\n      case \"chat:text\":\n        this.handleChatText(user, envelope.payload);\n        return;\n      case \"chat:image\":\n        this.handleChatImage(user, envelope.payload);\n        return;\n      default:\n        emitSystemError(user.socket, \"BAD_REQUEST\", \"Unsupported event.\");\n    }\n  }\n\n  private handleQueueJoin(user: UserSession, rawPayload: unknown): void {\n    if (!this.rateLimiter.allow(user.ip, \"queue_join\", 5, 10)) {\n      emitSystemError(user.socket, \"RATE_LIMITED\", \"Too many queue requests.\");\n      return;\n    }\n\n    const payload = parseQueueJoinPayload(rawPayload);\n    if (payload?.alias) {\n      const alias = normalizeAlias(payload.alias);\n      if (alias) {\n        user.alias = alias;\n      }\n    }\n\n    const matched = this.enqueueAndMatch(user);\n    if (matched) {\n      this.adminService.broadcastMetrics();\n    }\n  }\n\n  private handleRoomSkip(user: UserSession): void {\n    if (!this.rateLimiter.allow(user.ip, \"room_skip\", 5, 10)) {\n      emitSystemError(user.socket, \"RATE_LIMITED\", \"Skip rate limit exceeded.\");\n      return;\n    }\n\n    const ended = this.roomService.endByUser(user.userId, \"skip\");\n    const matched = this.enqueueAndMatch(user);\n\n    if (ended || matched) {\n      this.adminService.broadcastMetrics();\n    }\n  }\n\n  private handleRoomStay(user: UserSession): void {\n    if (user.roomId) {\n      return;\n    }\n\n    const matched = this.enqueueAndMatch(user);\n    if (matched) {\n      this.adminService.broadcastMetrics();\n    }\n  }\n\n  private handleChatText(user: UserSession, rawPayload: unknown): void {\n    if (!this.rateLimiter.allow(user.ip, \"chat_text\", 25, 5)) {\n      emitSystemError(user.socket, \"RATE_LIMITED\", \"Message rate limit exceeded.\");\n      return;\n    }\n\n    const payload = parseChatTextPayload(rawPayload);\n    if (!payload) {\n      emitSystemError(user.socket, \"BAD_REQUEST\", \"Invalid message payload.\");\n      return;\n    }\n\n    const text = sanitizeText(payload.text.trim());\n    if (!text) {\n      return;\n    }\n\n    if (text.length > this.config.maxMessageLength) {\n      emitSystemError(\n        user.socket,\n        \"MESSAGE_TOO_LONG\",\n        `Message max length is ${this.config.maxMessageLength}.`\n      );\n      return;\n    }\n\n    this.roomService.relayText(user.userId, text);\n  }\n\n  private handleChatImage(user: UserSession, rawPayload: unknown): void {\n    if (!this.rateLimiter.allow(user.ip, \"chat_image\", 3, 5)) {\n      emitSystemError(user.socket, \"RATE_LIMITED\", \"Image rate limit exceeded.\");\n      return;\n    }\n\n    const payload = parseChatImagePayload(rawPayload);\n    if (!payload?.mime || !ALLOWED_IMAGE_MIME.has(payload.mime)) {\n      emitSystemError(user.socket, \"UNSUPPORTED_IMAGE\", \"Supported image mime: jpeg, png, webp.\");\n      return;\n    }\n\n    if (!payload.data || typeof payload.data !== \"string\") {\n      emitSystemError(user.socket, \"BAD_REQUEST\", \"Invalid image payload.\");\n      return;\n    }\n\n    const imageSize = base64ByteLength(payload.data);\n    if (imageSize > this.config.maxImageBytes) {\n      emitSystemError(\n        user.socket,\n        \"IMAGE_TOO_LARGE\",\n        `Image max size is ${this.config.maxImageBytes} bytes.`\n      );\n      return;\n    }\n\n    this.roomService.relayImage(user.userId, payload.mime, payload.data);\n  }\n\n  private enqueueAndMatch(user: UserSession): boolean {\n    if (user.roomId) {\n      emitSystemError(user.socket, \"BAD_REQUEST\", \"Leave the active room before joining queue.\");\n      return false;\n    }\n\n    this.queueService.enqueue(user.userId);\n    emit(user.socket, \"queue:waiting\");\n\n    const matches = this.queueService.createMatches();\n    if (matches.length === 0) {\n      return false;\n    }\n\n    for (const match of matches) {\n      emit(match.first.socket, \"room:matched\", {\n        roomId: match.room.roomId,\n        partnerId: match.second.userId,\n        partnerAlias: match.second.alias\n      });\n\n      emit(match.second.socket, \"room:matched\", {\n        roomId: match.room.roomId,\n        partnerId: match.first.userId,\n        partnerAlias: match.first.alias\n      });\n    }\n\n    return true;\n  }\n\n  private disconnectUser(userId: string): void {\n    const user = this.chatState.users.get(userId);\n    if (!user) {\n      return;\n    }\n\n    this.roomService.endByUser(userId, \"disconnect\");\n    this.queueService.remove(userId);\n    this.chatState.users.delete(userId);\n    this.adminService.broadcastMetrics();\n  }\n}\n", "import { handleEdgeRequest } from \"./http-gateway\";\nimport { ChatDurableObject } from \"./chat-durable-object\";\nimport type { Env } from \"./types\";\n\nexport { ChatDurableObject };\n\nexport default {\n  async fetch(request: Request, env: Env): Promise<Response> {\n    return handleEdgeRequest(request, env);\n  }\n};\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/mac/Desktop/anon_cb/apps/worker/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/mac/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/mac/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/mac/Desktop/anon_cb/apps/worker/src/index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/mac/Desktop/anon_cb/apps/worker/.wrangler/tmp/bundle-PuNaRI/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/mac/.npm/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/mac/Desktop/anon_cb/apps/worker/.wrangler/tmp/bundle-PuNaRI/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/mac/Desktop/anon_cb/apps/worker/.wrangler/tmp/bundle-PuNaRI/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
